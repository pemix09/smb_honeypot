services:
  # Service 1: Honeypot Server (Rust)
  # Runs in the background, listens on port 445, and saves data to the database.
  honeypot:
    build: ./smb_server
    container_name: smb_honeypot
    ports:
      - "445:445"
    volumes:
      - ./data:/app/data  # Shared volume for the database
    restart: always
    networks:
      - smb_net

  # Service 2: Data Exporter (Python)
  # Run manually to generate a CSV from the database.
  exporter:
    image: python:3.9-slim
    container_name: smb_exporter
    volumes:
      - ./data:/app/data        # Access to the database
      - ./scripts:/app/scripts  # Access to the script
    working_dir: /app
    # By default, it runs the script and then exits
    command: python scripts/dataset_exporter.py
    networks:
      - smb_net

networks:
  smb_net: